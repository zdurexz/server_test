prontera,163,139,3	script	Enchant Equipment	10058,{
	disable_items;
	
	.@npc_name$ = "Enchant Equipment";
	.@cash_price = 10;
	
	mes "["+ .@npc_name$ +"]";
	mes "เลือกอุปกรณ์ Costume, Shadow ที่ต้องการสุ่มฝังพลังได้เลย";
	mes "---";
	mes "โอกาสติด 100%";
	mes "---";
	mes "ค่าบริการ: " + .@cash_price + " Cash";
	next;
	menu "สุ่มปกติ",L_Normal,"สุ่มจนกว่าจะได้",-;
	mes "โปรดใส่ ID Enchant ที่ต้องการ";
	input .@target_enchant;
	freeloop(1);
	for(.@i = 0; .@i < getarraysize(.all_stone); .@i++) {
		if(.all_stone[.@i] == .@target_enchant){
			goto L_Normal;
			break;
		}
	}
	freeloop(0);
	mes "ไม่พบ Enchant ที่ต้องการ";
	close;
	
	L_Normal:
	freeloop(0);
	if(.@target_enchant)
	mes "คุณเลือก Enchant: " + getitemname(.@target_enchant);
	setarray .@indices[1],EQI_COSTUME_HEAD_TOP,EQI_COSTUME_HEAD_MID,EQI_COSTUME_HEAD_LOW,EQI_COSTUME_GARMENT,EQI_SHADOW_ARMOR,EQI_SHADOW_WEAPON,EQI_SHADOW_SHIELD,EQI_SHADOW_SHOES,EQI_SHADOW_ACC_R,EQI_SHADOW_ACC_L;
	for(.@i = 1; .@i<getarraysize(.@indices); ++.@i) {
		if(getequipisequiped(.@indices[.@i])) {
			.@menu$ = .@menu$ + F_getpositionname(.@indices[.@i]) + "-[" + getequipname(.@indices[.@i]) + "]";
			.@equipped = 1;
		}
		.@menu$ = .@menu$ + ":";
	}
	
	if (.@equipped == 0) {
		mes "["+ .@npc_name$ +"]";
		mes "เกิดข้อผิดพลาด #1";
		close;
	}
	
	.@part = .@indices[select(.@menu$)];

	if(!getequipisequiped(.@part)) {
		mes "["+ .@npc_name$ +"]";
		mes "เกิดข้อผิดพลาด #2";
		close;
	}

	.@slot = select("ช่อง 1:ช่อง 2:ช่อง 3:ช่อง 4");

	callfunc("IsCashEnough",.@cash_price,"",1);

	.@item = getequipid(.@part);
	
	.@rand_stone = .all_stone[rand(0,getarraysize(.all_stone)-1)];
	
	if(.@target_enchant)
	callfunc("MyCash");
	freeloop(1);
	while(.@target_enchant && .@target_enchant != .@rand_stone){
		if(#CASHPOINTS >= .@cash_price){
			callfunc("UseCash",.@cash_price,1,1);
			.@rand_stone = .all_stone[rand(0,getarraysize(.all_stone)-1)];
		}
		else
		break;
	}
	freeloop(0);
	if(.@target_enchant)
	callfunc("MyCash");
	
	.@rand_refine_count = getequiprefinerycnt(.@part);
	.@card0 = getequipcardid(.@part,0);
	.@card1 = getequipcardid(.@part,1);
	.@card2 = getequipcardid(.@part,2);
	.@card3 = getequipcardid(.@part,3);
	setd(".@card" + (.@slot - 1),.@rand_stone);
	.@save_ro_id_slot1 = 0;
	.@save_ro_id_slot2 = 0;
	.@save_ro_id_slot3 = 0;
	.@save_ro_id_slot4 = 0;
	.@save_ro_id_slot5 = 0;
	.@save_ro_val_slot1 = 0;
	.@save_ro_val_slot2 = 0;
	.@save_ro_val_slot3 = 0;
	.@save_ro_val_slot4 = 0;
	.@save_ro_val_slot5 = 0;
	if(getequiprandomoption(.@part,4,ROA_ID) > 0){
		.@save_ro_id_slot5 = getequiprandomoption(.@part,4,ROA_ID);
		.@save_ro_val_slot5 = getequiprandomoption(.@part,4,ROA_VALUE);
	}
	if(getequiprandomoption(.@part,3,ROA_ID) > 0){
		.@save_ro_id_slot4 = getequiprandomoption(.@part,3,ROA_ID);
		.@save_ro_val_slot4 = getequiprandomoption(.@part,3,ROA_VALUE);
	}
	if(getequiprandomoption(.@part,2,ROA_ID) > 0){
		.@save_ro_id_slot3 = getequiprandomoption(.@part,2,ROA_ID);
		.@save_ro_val_slot3 = getequiprandomoption(.@part,2,ROA_VALUE);
	}
	if(getequiprandomoption(.@part,1,ROA_ID) > 0){
		.@save_ro_id_slot2 = getequiprandomoption(.@part,1,ROA_ID);
		.@save_ro_val_slot2 = getequiprandomoption(.@part,1,ROA_VALUE);
	}
	if(getequiprandomoption(.@part,0,ROA_ID) > 0){
		.@save_ro_id_slot1 = getequiprandomoption(.@part,0,ROA_ID);
		.@save_ro_val_slot1 = getequiprandomoption(.@part,0,ROA_VALUE);
	}
	
	delequip .@part;
	
	setarray .@optID[0],.@save_ro_id_slot1,.@save_ro_id_slot2,.@save_ro_id_slot3,.@save_ro_id_slot4,.@save_ro_id_slot5;
	setarray .@optVal[0],.@save_ro_val_slot1,.@save_ro_val_slot2,.@save_ro_val_slot3,.@save_ro_val_slot4,.@save_ro_val_slot5;
	setarray .@optParam[0],0,0,0,0,0;
	
	if(!.@save_ro_id_slot1 && !.@save_ro_id_slot2 && !.@save_ro_id_slot3 && !.@save_ro_id_slot4 && !.@save_ro_id_slot5)
	getitem2 .@item,1,1,.@rand_refine_count,0,.@card0,.@card1,.@card2,.@card3;
	else
	getitem3 .@item,1,1,.@rand_refine_count,0,.@card0,.@card1,.@card2,.@card3,.@optID,.@optVal,.@optParam;
	
	equip .@item;
	
	//announce strcharinfo(0) + " ใช้ " + .@cash_price + " Cash กับ " + getequipname(.@part) + " ได้รับ Enchant " + getitemname(.@rand_stone) + "!!",bc_all,0xedeaaf;
	dispbottom getequipname(.@part) + " ได้รับ Enchant " + getitemname(.@rand_stone) + "!!";

	close;
	
OnInit:
	setarray .all_stone[0],4700,4701,4702,4703,4704,4705,4706,4707,4708,4709,4710,4711,4712,4713,4714,4715,4716,4717,4718,4719,4720,4721,4722,4723,4724,4725,4726,4727,4728,4729,4730,4731,4732,4733,4734,4735,4736,4737,4738,4739,4740,4741,4742,4743,4744,4745,4746,4747,4748,4749,4750,4751,4752,4753,4754,4755,4756,4757,4758,4759,4760,4761,4762,4763,4764,4765,4766,4767,4768,4769,4770,4771,4772,4773,4774,4775,4776,4777,4778,4779,4780,4781,4782,4783,4784,4785,4786,4787,4788,4789,4790,4791,4792,4793,4794,4795,4796,4797,4798,4799,4800,4801,4802,4803,4804,4805,4806,4807,4808,4809,4810,4811,4812,4813,4814,4815,4816,4817,4818,4819,4820,4821,4822,4823,4824,4825,4826,4827,4828,4829,4830,4831,4832,4833,4834,4835,4836,4837,4838,4839,4840,4841,4842,4843,4844,4845,4846,4847,4848,4849,4850,4851,4852,4853,4854,4855,4856,4857,4858,4859,4860,4861,4862,4863,4864,4865,4866,4867,4868,4869,4870,4871,4872,4873,4875,4876,4877,4878,4879,4880,4881,4882,4883,4884,4885,4886,4887,4888,4889,4890,4891,4892,4893,4894,4895,4896,4897,4898,4899,4900,4902,4903,4904,4905,4906,4907,4908,4909,4910,4911,4912,4913,4914,4915,4916,4917,4918,4919,4920,4921,4922,4923,4924,4925,4926,4927,4928,4929,4930,4931,4932,4933,4934,4935,4936,4937,4938,4939,4940,4941,4942,4943,4944,4945,4946,4947,4948,4949,4950,4951,4952,4953,4954,4955,4956,4957,4958,4959,4960,4961,4962,4963,4964,4965,4966,4967,4968,4969,4970,4971,4972,4973,4974,4975,4976,4977,4978,4979,4980,4981,4982,4983,4984,4985,4986,4987,4988,4989,4990,4991,4992,4993,4994,4995,4996,4997,4998,4999,6716,6717,6718,6740,6741,6742,6743,6744,6745,6790,6791,6792,6908,6943,6944,6945,6946,6947,6948,6949,6950,6951,25066,25670,25671,25672,25673,25674,25675,25676,25677,25678,25679,25680,25681,25682,25683,25684,25685,25686,25687,25688,25689,25690,25691,25692,25693,25694,25695,25696,25697,25698,25699,25700,25701,25702,25703,25704,25705,29000,29001,29002,29003,29004,29005,29006,29007,29008,29009,29010,29011,29013,29014,29015,29016,29017,29018,29019,29020,29021,29022,29023,29024,29025,29026,29027,29028,29029,29030,29031,29032,29033,29040,29041,29046,29047,29048,29049,29050,29051,29052,29053,29054,29055,29056,29057,29061,29062,29063,29064,29065,29066,29067,29068,29069,29070,29071,29072,29073,29074,29075,29076,29077,29078,29079,29080,29081,29082,29083,29084,29085,29086,29087,29088,29089,29090,29091,29092,29093,29094,29095,29096,29097,29098,29099,29100,29101,29102,29103,29104,29105,29106,29107,29108,29109,29110,29111,29112,29113,29114,29115,29116,29117,29118,29119,29120,29121,29122,29123,29124,29125,29126,29142,29143,29144,29145,29146,29147,29148,29149,29150,29151,29152,29153,29154,29155,29156,29157,29158,29159,29160,29161,29162,29166,29167,29168,29169,29170,29171,29172,29173,29174,29175,29176,29224,29225,29226,29227,29228,29229,29310,29311,29312,29313,29314,29315,29316,29317,29318,29319,29320,29321,29322,29323,29324,29325,29326,29327,29328,29329,29330,29331,29332,29333,29334,29335,29336,29337,29338,29339,29340,29341,29342,29343,29344,29345,29346,29347,29348,29349,29350,29351,29352,29353,29354,29355,29356,29357,29358,29359,29360,29361,29362,29423,29424,29425,29426,29427,29428,29429,29430,29431,29432,29433,29434,29435,29438,29439,29440,29441,29442,29443,29444,29460,29461,29462,29463,29464,29465,29466,29467,29468,29469,29470,29471,29477,29478,29479,29480,29481,29482,29483,29484,29485,29486,29487,29488,29513,29514,29515,29516,29517,29518,29519,29520,29521,29522,29523,29524,29579,29580,29581,29582,29583,29584,29594,29595,29596,29598,29599,29600,29601,29602,29603,29604,29605,29606,29607,29611,29612,29613,29614,29615,29616,29617,29618,29619,29620,29621,29651,29652,29653,29654,29655,29656,29657,29658,29659,29660,29661,29662,29663,29664,29665,29666,29667,29668,29669,29670,29671,29672,29673,29674,29675,29676,29677,29678,29679,29680,29681,29682,29683,29684,29685,29686,29687,29688,29689,310000,310001,310002,310003,310004,310005,310006,310007,310008,310009,310010,310011,310076,310077,310078,310079,310080,310081,310082,310083,310084,310085,310086,310087,310088,310089,310090,310091,310092,310093,310094,310095,310096,310097,310098,310099,310100,310101,310102,310103,310104,310105,310106,310107,310108,310109,310110,310111,310112,310113,310114,310115,310116,310117,310118,310119,310120,310121,310122,310123,310124,310125,310126,310127,310128,310129,310130,310131,310132,310133,310134,310135,310136,310137,310138,310139,310140,310141,310142,310143,310144,310145,310146,310147,310148,310149,310150,310151,310152,310153,310154,310155,310156,310157,310158,310159,310160,310161,310162,310163,310164,310165,310166,310167,310168,310169,310170,310171,310172,310173,310174,310175,310176,310177,310180,310181,310182,310183,310184,310185,310186,310187,310188,310189,310190,310191,4700,4701,4702,4703,4704,4705,4706,4707,4708,4709,4710,4711,4712,4713,4714,4715,4716,4717,4718,4719,4720,4721,4722,4723,4724,4725,4726,4727,4728,4729,4730,4731,4732,4733,4734,4735,4736,4737,4738,4739,4740,4741,4742,4743,4744,4745,4746,4747,4748,4749,4750,4751,4752,4753,4754,4755,4756,4757,4758,4759,4760,4761,4762,4763,4764,4765,4766,4767,4768,4769,4770,4771,4772,4773,4774,4775,4776,4777,4778,4779,4780,4781,4782,4783,4784,4785,4786,4787,4788,4789,4790,4791,4792,4793,4794,4795,4796,4797,4798,4799,4800,4801,4802,4803,4804,4805,4806,4807,4808,4809,4810,4811,4812,4813,4814,4815,4816,4817,4818,4819,4820,4821,4822,4823,4824,4825,4826,4827,4828,4829,4830,4831,4832,4833,4834,4835,4836,4837,4838,4839,4840,4841,4842,4843,4844,4845,4846,4847,4848,4849,4850,4851,4852,4853,4854,4855,4856,4857,4858,4859,4860,4861,4862,4863,4864,4865,4866,4867,4868,4869,4870,4871,4872,4873,4875,4876,4877,4878,4879,4880,4881,4882,4883,4884,4885,4886,4887,4888,4889,4890,4891,4892,4893,4894,4895,4896,4897,4898,4899,4900,4902,4903,4904,4905,4906,4907,4908,4909,4910,4911,4912,4913,4914,4915,4916,4917,4918,4919,4920,4921,4922,4923,4924,4925,4926,4927,4928,4929,4930,4931,4932,4933,4934,4935,4936,4937,4938,4939,4940,4941,4942,4943,4944,4945,4946,4947,4948,4949,4950,4951,4952,4953,4954,4955,4956,4957,4958,4959,4960,4961,4962,4963,4964,4965,4966,4967,4968,4969,4970,4971,4972,4973,4974,4975,4976,4977,4978,4979,4980,4981,4982,4983,4984,4985,4986,4987,4988,4989,4990,4991,4992,4993,4994,4995,4996,4997,4998,4999,6716,6717,6718,6740,6741,6742,6743,6744,6745,6790,6791,6792,6908,6943,6944,6945,6946,6947,6948,6949,6950,6951,25066,25670,25671,25672,25673,25674,25675,25676,25677,25678,25679,25680,25681,25682,25683,25684,25685,25686,25687,25688,25689,25690,25691,25692,25693,25694,25695,25696,25697,25698,25699,25700,25701,25702,25703,25704,25705,29000,29001,29002,29003,29004,29005,29006,29007,29008,29009,29010,29011,29013,29014,29015,29016,29017,29018,29019,29020,29021,29022,29023,29024,29025,29026,29027,29028,29029,29030,29031,29032,29033,29040,29041,29046,29047,29048,29049,29050,29051,29052,29053,29054,29055,29056,29057,29061,29062,29063,29064,29065,29066,29067,29068,29069,29070,29071,29072,29073,29074,29075,29076,29077,29078,29079,29080,29081,29082,29083,29084,29085,29086,29087,29088,29089,29090,29091,29092,29093,29094,29095,29096,29097,29098,29099,29100,29101,29102,29103,29104,29105,29106,29107,29108,29109,29110,29111,29112,29113,29114,29115,29116,29117,29118,29119,29120,29121,29122,29123,29124,29125,29126,29142,29143,29144,29145,29146,29147,29148,29149,29150,29151,29152,29153,29154,29155,29156,29157,29158,29159,29160,29161,29162,29166,29167,29168,29169,29170,29171,29172,29173,29174,29175,29176,29224,29225,29226,29227,29228,29229,29310,29311,29312,29313,29314,29315,29316,29317,29318,29319,29320,29321,29322,29323,29324,29325,29326,29327,29328,29329,29330,29331,29332,29333,29334,29335,29336,29337,29338,29339,29340,29341,29342,29343,29344,29345,29346,29347,29348,29349,29350,29351,29352,29353,29354,29355,29356,29357,29358,29359,29360,29361,29362,29423,29424,29425,29426,29427,29428,29429,29430,29431,29432,29433,29434,29435,29438,29439,29440,29441,29442,29443,29444,29460,29461,29462,29463,29464,29465,29466,29467,29468,29469,29470,29471,29477,29478,29479,29480,29481,29482,29483,29484,29485,29486,29487,29488,29513,29514,29515,29516,29517,29518,29519,29520,29521,29522,29523,29524,29579,29580,29581,29582,29583,29584,29594,29595,29596,29598,29599,29600,29601,29602,29603,29604,29605,29606,29607,29611,29612,29613,29614,29615,29616,29617,29618,29619,29620,29621,29651,29652,29653,29654,29655,29656,29657,29658,29659,29660,29661,29662,29663,29664,29665,29666,29667,29668,29669,29670,29671,29672,29673,29674,29675,29676,29677,29678,29679,29680,29681,29682,29683,29684,29685,29686,29687,29688,29689,310000,310001,310002,310003,310004,310005,310006,310007,310008,310009,310010,310011,310076,310077,310078,310079,310080,310081,310082,310083,310084,310085,310086,310087,310088,310089,310090,310091,310092,310093,310094,310095,310096,310097,310098,310099,310100,310101,310102,310103,310104,310105,310106,310107,310108,310109,310110,310111,310112,310113,310114,310115,310116,310117,310118,310119,310120,310121,310122,310123,310124,310125,310126,310127,310128,310129,310130,310131,310132,310133,310134,310135,310136,310137,310138,310139,310140,310141,310142,310143,310144,310145,310146,310147,310148,310149,310150,310151,310152,310153,310154,310155,310156,310157,310158,310159,310160,310161,310162,310163,310164,310165,310166,310167,310168,310169,310170,310171,310172,310173,310174,310175,310176,310177,310180,310181,310182,310183,310184,310185,310186,310187,310188,310189,310190,310191;
	waitingroom "Enchant Equipment",0;
	end;
}

